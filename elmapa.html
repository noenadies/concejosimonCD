<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple Markers</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #idbtatras{

        position: absolute;
        top: 3%;
        left: 90%;
        width: 50px;
        height: 25px;
        background-color: black;
        color: rgb(255, 255, 255);
        font-size: 13px;
        z-index: 3;
      }
    </style>

<script src="https://www.gstatic.com/firebasejs/5.8.3/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyABOpIJyC5XDTAlqwVauPAZET6uUmeMbiQ",
    authDomain: "concejosimoncd.firebaseapp.com",
    databaseURL: "https://concejosimoncd.firebaseio.com",
    projectId: "concejosimoncd",
    storageBucket: "concejosimoncd.appspot.com",
    messagingSenderId: "879095685896"
  };
  firebase.initializeApp(config);
</script>
  </head>
  <body> <button id="idbtatras" onclick="fidbtatras();">Atras</button>
    <div id="map"></div>
    <script>

var todomksdir={ant:0,des:0,ahora:0};

var todovotantest={ant:0,des:0,ahora:0};
var   arraytvotordenode=[];
var arraytodomarksdirordenode=[];
  /*firebase.database().ref("votantes").orderByChild("puesto").on("child_added", function(snapshot) {
  console.log(snapshot.val());
  });*/
var idxllamtodotodo=0;
var vllegueunsaves=0;
var arraysupremo=[];
var arraycontandovotantesplaza=[];
var vcontandovotantesplaza=0;
/*
var varrayvotante={cedula:arraytodoordenode[i].cedula,departamento:arraytodoordenode[i].departamento,
    direccion:arraytodoordenode[i].direccion,
email:arraytodoordenode[i].email,
facebook:arraytodoordenode[i].facebook,
fecha:arraytodoordenode[i].fecha,
idreferido:arraytodoordenode[i].idreferido,
mesa:arraytodoordenode[i].mesa,
movil:arraytodoordenode[i].movil,
municipio:arraytodoordenode[i].municipio ,
notareferido:arraytodoordenode[i].notareferido,
nombres:arraytodoordenode[i].nombre ,
notauser:arraytodoordenode[i].notauser,
referido:arraytodoordenode[i].referido,
puesto:arraytodoordenode[i].puesto
 
  
  }*/
 var  arraydireccion=[];
var vsupremo={array:1,direccion:1,idx:0};

inictraemarksdirecci();

function inictraemarksdirecci(){
  traetodoormarkdiredenadopor("direccion");
traetodoorvotadenadopor("direccion");
floop();
}




function floop(){

  
setInterval(function(){ 

if(arraytodomarksdirordenode.length==todomksdir.des){
  setTimeout(function(){
    todomksdir.des=0;
    llenonodomarksdirec();
   // elforordenatodopornodo();
 //   creatd();
  },2000)
  }

  if(arraytvotordenode.length==todovotantest.des){
  setTimeout(function(){
    todovotantest.des=0;
    llenonodovotante();
   // elforordenatodopornodo();
 //   creatd();
  },2000)
  }








 }, 3000);

}





function traetodoormarkdiredenadopor(st1){
  firebase.database().ref("plazaslatlng").orderByChild(String(st1)).on("child_added", function(snapshot) {
 // console.log(snapshot.val());
  //todovotantest=snapshot.val();
  arraytodomarksdirordenode.push(snapshot.val());
//  console.log("long  "+ todovotantest.des);
 // elforordenatodopornodo();
// creatd();
todomksdir.ant=todomksdir.ahora;
todomksdir.ahora=todomksdir.ahora+1;
todomksdir.des=todomksdir.ahora;

//console.log(snapshot.val().length);




  });


}



function traetodoorvotadenadopor(st1){
  firebase.database().ref("votantes").orderByChild(String(st1)).on("child_added", function(snapshot) {
 // console.log(snapshot.val());
  //todovotantest=snapshot.val();
  arraytvotordenode.push(snapshot.val());
//  console.log("long  "+ todovotantest.des);
 // elforordenatodopornodo();
// creatd();
todovotantest.ant=todovotantest.ahora;
todovotantest.ahora=todovotantest.ahora+1;
todovotantest.des=todovotantest.ahora;

console.log(snapshot.val().length);




  });


}




function llenonodomarksdirec(){
  /*
   console.log(arraytodomarksdirordenode.length);
  for(var i in arraytodomarksdirordenode){

    
    console.log(arraytodomarksdirordenode[i].direccion);


  }*/
   

}



function llenonodovotante(){
  /*
  console.log(arraytvotordenode.length);
 for(var ii in arraytvotordenode){

   
   console.log(arraytvotordenode[ii].direccion);


 }*/
 comparandodirecciones();

}


var ce=0;
var vvotante;
var idvotante=0;

var io=0;
function comparandodirecciones(){
  for(var i in arraytodomarksdirordenode){

    io=0;

for(var ii in arraytvotordenode){

   
//console.log(arraytvotordenode[ii].direccion);
if(arraytodomarksdirordenode[i].direccion==arraytvotordenode[ii].direccion){
  console.log("son iguales  "+arraytodomarksdirordenode[i].direccion+" mk   vt "+arraytvotordenode[ii].direccion);


vvotante={cedula:arraytvotordenode[ii].cedula,departamento:arraytvotordenode[ii].departamento,
  direccion:arraytvotordenode[ii].direccion,
email:arraytvotordenode[ii].email,
facebook:arraytvotordenode[ii].facebook,
fecha:arraytvotordenode[ii].fecha,
idreferido:arraytvotordenode[ii].idreferido,
mesa:arraytvotordenode[ii].mesa,
movil:arraytvotordenode[ii].movil,
municipio:arraytvotordenode[ii].municipio ,
notareferido:arraytvotordenode[ii].notareferido,
nombres:arraytvotordenode[ii].nombre ,
notauser:arraytvotordenode[ii].notauser,
referido:arraytvotordenode[ii].referido,
puesto:arraytvotordenode[ii].puesto
 
  
  };

  arraydireccion.push({idx:io,arrvotante:vvotante,direccion:arraytvotordenode[ii].direccion});
  io=io+1;
 
}




}



if(io>0){
 // arraycontandovotantesplaza.push({idx:io-1,cantidadvotan:io,direccion:arraytvotordenode[ii].direccion,puesto:arraytvotordenode[ii].puesto});
 arraysupremo.push({arrarydir:arraydireccion,direccion:arraydireccion[arraydireccion.length-1].direccion,
lat:0,lng:0,cantidad:io});
}
else{
  io=0;
}











ce=ce+1;
    
//console.log(arraydireccion);
console.log("----------");

}
console.log( arraydireccion.length);
console.log(   arraysupremo[1].direccion);
siincimap=true;initMap();
}




function elforordenatodopornodo(){

for(var i in arraytodoordenode){
    

  arraypuestooder.push({cedula:arraytodoordenode[i].cedula,departamento:arraytodoordenode[i].departamento,
    direccion:arraytodoordenode[i].direccion,
email:arraytodoordenode[i].email,
facebook:arraytodoordenode[i].facebook,
fecha:arraytodoordenode[i].fecha,
idreferido:arraytodoordenode[i].idreferido,
mesa:arraytodoordenode[i].mesa,
movil:arraytodoordenode[i].movil,
municipio:arraytodoordenode[i].municipio ,
notareferido:arraytodoordenode[i].notareferido,
nombres:arraytodoordenode[i].nombre ,
notauser:arraytodoordenode[i].notauser,
referido:arraytodoordenode[i].referido,
puesto:arraytodoordenode[i].puesto
 
  
  });

    

  }
}




















    var siincimap=false;
    var arraymarks=[];
    var map;
    var myLatLng= {lat: 4.693763, lng: -74.060678};
    function  fidbtatras(){
  window.location.href="index.html";

}//4.693763, -74.060678
      function initMap() {

        if(siincimap){
     myLatLng = {lat: 4.693763, lng: -74.060678};

      map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: myLatLng
        });

        crearmarcas();
        siincimap=false;
        }

      }

var ab=0;
      function crearmarcas(){

        for(var i in  arraysupremo){ab=ab+1;

var markx=new google.maps.Marker({
          position: {lat: 4.69+ab/100, lng: -74.0606789+ab/100},
          map: map,
          title:  String( arraysupremo[1].direccion)+" No Votantes: "+String( arraysupremo[1].cantidad)
        });
        arraymarks.push({direecion:1,marker:markx});
 

        arraymarks[arraymarks.length-1].marker.addListener('click', function(e) {
        //  map.setZoom(8);
         // map.setCenter(marker.getPosition());
         alert(this.title);
        });

}
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCV4ya46Yoag-iGeJb5SUwZ2q1Irx0UjnU&callback=initMap">
     </script>
  </body>
</html>